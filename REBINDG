-- SQL QUERY TO READ THE SYSIBM.SYSPACKAGE TABLE AND
-- GENERATE REBIND PACKAGES FOR EVERY PACKAGE THAT
--EXISTS

CREATE GLOBAL TEMPORARY TABLE T(LINENO INTEGER NOT NULL);
INSERT INTO SESSION.T VALUES 1;
INSERT INTO SESSION.T VALUES 2;
INSERT INTO SESSION.T VALUES 3;
INSERT INTO SESSION.T VALUES 4;
INSERT INTO SESSION.T VALUES 5;
INSERT INTO SESSION.T VALUES 6;
INSERT INTO SESSION.T VALUES 99;

SELECT
   CASE LINENO
      WHEN 1 THEN 'BIND PACKAGE (' CONCAT STRIP(COLLID) CONCAT ')'
                  'MEMBER (' CONCAT STRIP(NAME) CONCAT ') -'
      WHEN 2 THEN 'OWNER (' CONCAT STRIP(OWNER) CONCAT ')'
                  'QUALIFIER (' CONCAT STRIP(QUALIFIER) CONCAT ') -'
      WHEN 3 THEN 'LIBRARY (' CONCAT STRIP(PDSNAME) CONCAT ') -'
      WHEN 4 THEN 'VALIDATE (' CONCAT
         CASE VALIDATE
            WHEN 'B' THEN 'BIND'
            WHEN 'R' THEN 'RUN'
            ELSE 'RUN'
         END CONCAT ')' CONCAT
         CASE DEGREE
            WHEN '1' THEN 'DEGREE(1)'
            ELSE 'DEGREE(ANY)'
         END
         CONCAT ' -'
      WHEN 5 THEN 'CURRENTDATA (' CONCAT
         CASE DEFERPREP
            WHEN 'A' THEN 'YES'
            WHEN 'B' THEN 'NO'
            WHEN 'C' THEN 'YES'
            WHEN ' ' THEN 'NO'
         END CONCAT ')' CONCAT
         CASE STRIP(VERSION)
            WHEN '' THEN '-'
            ELSE 'VERSION (' CONCAT STRIP(VERSION) CONCAT ') -'
         END
      WHEN 6 THEN REOPT (' CONCAT
         CASE REOPT
            WHEN 'N' THEN 'NONE'
            WHEN 'A' THEN 'AUTO'
            WHEN 'Y' THEN 'ALWAYS'
            WHEN '1' THEN 'ONCE'
         END CONCAT ')' CONCAT
         CASE STRIP(RELEASE)
            WHEN 'C' THEN 'RELEASE(COMMIT)'
            WHEN 'D' THEN 'RELEASE(DEALLOCATE)'
            WHEN 'I' THEN 'RELEASE(INHERITFROMPLAN)'
            WHEN ''  THEN ''
         END
      WHEN 99 THEN ' '
      END
      FROM SESSION.T, SYSIBM.SYSPACKAGE
      WHERE LOCATION = ''
        AND STRIP(PDSNAME) <> ''
        AND NAME LIKE '%'
        AND VALID = 'Y'
        AND OPERATIVE = 'Y'
       ORDER BY CONTOKEN, NAME, COLLID, LINENO
       FOR FETCH ONLY
       WITH UR;
